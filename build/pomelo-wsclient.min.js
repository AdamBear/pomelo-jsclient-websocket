(function e(t,n,r){function s(o,u){if(!n[o]){if(!t[o]){var a=typeof require=="function"&&require;if(!u&&a)return a(o,!0);if(i)return i(o,!0);var f=new Error("Cannot find module '"+o+"'");throw f.code="MODULE_NOT_FOUND",f}var l=n[o]={exports:{}};t[o][0].call(l.exports,function(e){var n=t[o][1][e];return s(n?n:e)},l,l.exports,e,t,n,r)}return n[o].exports}var i=typeof require=="function"&&require;for(var o=0;o<r.length;o++)s(r[o]);return s})({1:[function(require,module,exports){(function(){var JS_WS_CLIENT_TYPE="js-websocket";var JS_WS_CLIENT_VERSION="0.0.1";var Protocol=window.Protocol;var protobuf=window.protobuf;var decodeIO_protobuf=window.decodeIO_protobuf;var decodeIO_encoder=null;var decodeIO_decoder=null;var Package=Protocol.Package;var Message=Protocol.Message;var EventEmitter=window.EventEmitter;var rsa=window.rsa;if(typeof window!="undefined"&&typeof sys!="undefined"&&sys.localStorage){window.localStorage=sys.localStorage}var RES_OK=200;var RES_FAIL=500;var RES_OLD_CLIENT=501;if(typeof Object.create!=="function"){Object.create=function(o){function F(){}F.prototype=o;return new F}}var root=window;var pomelo=Object.create(EventEmitter.prototype);root.pomelo=pomelo;var socket=null;var reqId=0;var callbacks={};var handlers={};var routeMap={};var dict={};var abbrs={};var serverProtos={};var clientProtos={};var protoVersion=0;var heartbeatInterval=0;var heartbeatTimeout=0;var nextHeartbeatTimeout=0;var gapThreshold=100;var heartbeatId=null;var heartbeatTimeoutId=null;var handshakeCallback=null;var decode=null;var encode=null;var reconnect=false;var reconncetTimer=null;var reconnectUrl=null;var reconnectAttempts=0;var reconnectionDelay=5e3;var DEFAULT_MAX_RECONNECT_ATTEMPTS=10;var useCrypto;var handshakeBuffer={sys:{type:JS_WS_CLIENT_TYPE,version:JS_WS_CLIENT_VERSION,rsa:{}},user:{}};var initCallback=null;pomelo.init=function(params,cb){initCallback=cb;var host=params.host;var port=params.port;encode=params.encode||defaultEncode;decode=params.decode||defaultDecode;var url="ws://"+host;if(port){url+=":"+port}handshakeBuffer.user=params.user;if(params.encrypt){useCrypto=true;rsa.generate(1024,"10001");var data={rsa_n:rsa.n.toString(16),rsa_e:rsa.e};handshakeBuffer.sys.rsa=data}handshakeCallback=params.handshakeCallback;connect(params,url,cb)};var defaultDecode=pomelo.decode=function(data){var msg=Message.decode(data);if(msg.id>0){msg.route=routeMap[msg.id];delete routeMap[msg.id];if(!msg.route){return}}msg.body=deCompose(msg);return msg};var defaultEncode=pomelo.encode=function(reqId,route,msg){var type=reqId?Message.TYPE_REQUEST:Message.TYPE_NOTIFY;if(protobuf&&clientProtos[route]){msg=protobuf.encode(route,msg)}else if(decodeIO_encoder&&decodeIO_encoder.lookup(route)){var Builder=decodeIO_encoder.build(route);msg=new Builder(msg).encodeNB()}else{msg=Protocol.strencode(JSON.stringify(msg))}var compressRoute=0;if(dict&&dict[route]){route=dict[route];compressRoute=1}return Message.encode(reqId,type,compressRoute,route,msg)};var connect=function(params,url,cb){console.log("connect to "+url);var params=params||{};var maxReconnectAttempts=params.maxReconnectAttempts||DEFAULT_MAX_RECONNECT_ATTEMPTS;reconnectUrl=url;if(window.localStorage&&window.localStorage.getItem("protos")&&protoVersion===0){var protos=JSON.parse(window.localStorage.getItem("protos"));protoVersion=protos.version||0;serverProtos=protos.server||{};clientProtos=protos.client||{};if(!!protobuf){protobuf.init({encoderProtos:clientProtos,decoderProtos:serverProtos})}if(!!decodeIO_protobuf){decodeIO_encoder=decodeIO_protobuf.loadJson(clientProtos);decodeIO_decoder=decodeIO_protobuf.loadJson(serverProtos)}}handshakeBuffer.sys.protoVersion=protoVersion;var onopen=function(event){if(!!reconnect){pomelo.emit("reconnect")}reset();var obj=Package.encode(Package.TYPE_HANDSHAKE,Protocol.strencode(JSON.stringify(handshakeBuffer)));send(obj)};var onmessage=function(event){processPackage(Package.decode(event.data),cb);if(heartbeatTimeout){nextHeartbeatTimeout=Date.now()+heartbeatTimeout}};var onerror=function(event){pomelo.emit("io-error",event);console.error("socket error: ",event)};var onclose=function(event){pomelo.emit("close",event);pomelo.emit("disconnect",event);console.error("socket close: ",event);if(!!params.reconnect&&reconnectAttempts<maxReconnectAttempts){reconnect=true;reconnectAttempts++;reconncetTimer=setTimeout(function(){connect(params,reconnectUrl,cb)},reconnectionDelay);reconnectionDelay*=2}};socket=new WebSocket(url);socket.binaryType="arraybuffer";socket.onopen=onopen;socket.onmessage=onmessage;socket.onerror=onerror;socket.onclose=onclose};pomelo.disconnect=function(){if(socket){if(socket.disconnect)socket.disconnect();if(socket.close)socket.close();console.log("disconnect");socket=null}if(heartbeatId){clearTimeout(heartbeatId);heartbeatId=null}if(heartbeatTimeoutId){clearTimeout(heartbeatTimeoutId);heartbeatTimeoutId=null}};var reset=function(){reconnect=false;reconnectionDelay=1e3*5;reconnectAttempts=0;clearTimeout(reconncetTimer)};pomelo.request=function(route,msg,cb){if(arguments.length===2&&typeof msg==="function"){cb=msg;msg={}}else{msg=msg||{}}route=route||msg.route;if(!route){return}reqId++;sendMessage(reqId,route,msg);callbacks[reqId]=cb;routeMap[reqId]=route};pomelo.notify=function(route,msg){msg=msg||{};sendMessage(0,route,msg)};var sendMessage=function(reqId,route,msg){if(useCrypto){msg=JSON.stringify(msg);var sig=rsa.signString(msg,"sha256");msg=JSON.parse(msg);msg["__crypto__"]=sig}if(encode){msg=encode(reqId,route,msg)}var packet=Package.encode(Package.TYPE_DATA,msg);send(packet)};var send=function(packet){if(socket)socket.send(packet.buffer)};var handler={};var heartbeat=function(data){if(!heartbeatInterval){return}var obj=Package.encode(Package.TYPE_HEARTBEAT);if(heartbeatTimeoutId){clearTimeout(heartbeatTimeoutId);heartbeatTimeoutId=null}if(heartbeatId){return}heartbeatId=setTimeout(function(){heartbeatId=null;send(obj);nextHeartbeatTimeout=Date.now()+heartbeatTimeout;heartbeatTimeoutId=setTimeout(heartbeatTimeoutCb,heartbeatTimeout)},heartbeatInterval)};var heartbeatTimeoutCb=function(){var gap=nextHeartbeatTimeout-Date.now();if(gap>gapThreshold){heartbeatTimeoutId=setTimeout(heartbeatTimeoutCb,gap)}else{console.error("server heartbeat timeout");pomelo.emit("heartbeat timeout");pomelo.disconnect()}};var handshake=function(data){data=JSON.parse(Protocol.strdecode(data));if(data.code===RES_OLD_CLIENT){pomelo.emit("error","client version not fullfill");return}if(data.code!==RES_OK){pomelo.emit("error","handshake fail");return}handshakeInit(data);var obj=Package.encode(Package.TYPE_HANDSHAKE_ACK);send(obj);if(initCallback){initCallback(socket)}};var onData=function(data){var msg=data;if(decode){msg=decode(msg)}processMessage(pomelo,msg)};var onKick=function(data){data=JSON.parse(Protocol.strdecode(data));pomelo.emit("onKick",data)};handlers[Package.TYPE_HANDSHAKE]=handshake;handlers[Package.TYPE_HEARTBEAT]=heartbeat;handlers[Package.TYPE_DATA]=onData;handlers[Package.TYPE_KICK]=onKick;var processPackage=function(msgs){if(Array.isArray(msgs)){for(var i=0;i<msgs.length;i++){var msg=msgs[i];handlers[msg.type](msg.body)}}else{handlers[msgs.type](msgs.body)}};var processMessage=function(pomelo,msg){if(!msg.id){pomelo.emit(msg.route,msg.body);return}var cb=callbacks[msg.id];delete callbacks[msg.id];if(typeof cb!=="function"){return}cb(msg.body);return};var processMessageBatch=function(pomelo,msgs){for(var i=0,l=msgs.length;i<l;i++){processMessage(pomelo,msgs[i])}};var deCompose=function(msg){var route=msg.route;if(msg.compressRoute){if(!abbrs[route]){return{}}route=msg.route=abbrs[route]}if(protobuf&&serverProtos[route]){return protobuf.decodeStr(route,msg.body)}else if(decodeIO_decoder&&decodeIO_decoder.lookup(route)){return decodeIO_decoder.build(route).decode(msg.body)}else{return JSON.parse(Protocol.strdecode(msg.body))}return msg};var handshakeInit=function(data){if(data.sys&&data.sys.heartbeat){heartbeatInterval=data.sys.heartbeat*1e3;heartbeatTimeout=heartbeatInterval*2}else{heartbeatInterval=0;heartbeatTimeout=0}initData(data);if(typeof handshakeCallback==="function"){handshakeCallback(data.user)}};var initData=function(data){if(!data||!data.sys){return}dict=data.sys.dict;var protos=data.sys.protos;if(dict){dict=dict;abbrs={};for(var route in dict){abbrs[dict[route]]=route}}if(protos){protoVersion=protos.version||0;serverProtos=protos.server||{};clientProtos=protos.client||{};window.localStorage.setItem("protos",JSON.stringify(protos));if(!!protobuf){protobuf.init({encoderProtos:protos.client,decoderProtos:protos.server})}if(!!decodeIO_protobuf){decodeIO_encoder=decodeIO_protobuf.loadJson(clientProtos);decodeIO_decoder=decodeIO_protobuf.loadJson(serverProtos)}}};module.exports=pomelo})()},{}],2:[function(require,module,exports){(function(global){"use strict";var base64=require("base64-js");var ieee754=require("ieee754");var isArray=require("isarray");exports.Buffer=Buffer;exports.SlowBuffer=SlowBuffer;exports.INSPECT_MAX_BYTES=50;Buffer.poolSize=8192;var rootParent={};Buffer.TYPED_ARRAY_SUPPORT=global.TYPED_ARRAY_SUPPORT!==undefined?global.TYPED_ARRAY_SUPPORT:typedArraySupport();function typedArraySupport(){try{var arr=new Uint8Array(1);arr.foo=function(){return 42};return arr.foo()===42&&typeof arr.subarray==="function"&&arr.subarray(1,1).byteLength===0}catch(e){return false}}function kMaxLength(){return Buffer.TYPED_ARRAY_SUPPORT?2147483647:1073741823}function Buffer(arg){if(!(this instanceof Buffer)){if(arguments.length>1)return new Buffer(arg,arguments[1]);return new Buffer(arg)}if(!Buffer.TYPED_ARRAY_SUPPORT){this.length=0;this.parent=undefined}if(typeof arg==="number"){return fromNumber(this,arg)}if(typeof arg==="string"){return fromString(this,arg,arguments.length>1?arguments[1]:"utf8")}return fromObject(this,arg)}Buffer._augment=function(arr){arr.__proto__=Buffer.prototype;return arr};function fromNumber(that,length){that=allocate(that,length<0?0:checked(length)|0);if(!Buffer.TYPED_ARRAY_SUPPORT){for(var i=0;i<length;i++){that[i]=0}}return that}function fromString(that,string,encoding){if(typeof encoding!=="string"||encoding==="")encoding="utf8";var length=byteLength(string,encoding)|0;that=allocate(that,length);that.write(string,encoding);return that}function fromObject(that,object){if(Buffer.isBuffer(object))return fromBuffer(that,object);if(isArray(object))return fromArray(that,object);if(object==null){throw new TypeError("must start with number, buffer, array or string")}if(typeof ArrayBuffer!=="undefined"){if(object.buffer instanceof ArrayBuffer){return fromTypedArray(that,object)}if(object instanceof ArrayBuffer){return fromArrayBuffer(that,object)}}if(object.length)return fromArrayLike(that,object);return fromJsonObject(that,object)}function fromBuffer(that,buffer){var length=checked(buffer.length)|0;that=allocate(that,length);buffer.copy(that,0,0,length);return that}function fromArray(that,array){var length=checked(array.length)|0;that=allocate(that,length);for(var i=0;i<length;i+=1){that[i]=array[i]&255}return that}function fromTypedArray(that,array){var length=checked(array.length)|0;that=allocate(that,length);for(var i=0;i<length;i+=1){that[i]=array[i]&255}return that}function fromArrayBuffer(that,array){array.byteLength;if(Buffer.TYPED_ARRAY_SUPPORT){that=new Uint8Array(array);that.__proto__=Buffer.prototype}else{that=fromTypedArray(that,new Uint8Array(array))}return that}function fromArrayLike(that,array){var length=checked(array.length)|0;that=allocate(that,length);for(var i=0;i<length;i+=1){that[i]=array[i]&255}return that}function fromJsonObject(that,object){var array;var length=0;if(object.type==="Buffer"&&isArray(object.data)){array=object.data;length=checked(array.length)|0}that=allocate(that,length);for(var i=0;i<length;i+=1){that[i]=array[i]&255}return that}if(Buffer.TYPED_ARRAY_SUPPORT){Buffer.prototype.__proto__=Uint8Array.prototype;Buffer.__proto__=Uint8Array;if(typeof Symbol!=="undefined"&&Symbol.species&&Buffer[Symbol.species]===Buffer){Object.defineProperty(Buffer,Symbol.species,{value:null,configurable:true})}}else{Buffer.prototype.length=undefined;Buffer.prototype.parent=undefined}function allocate(that,length){if(Buffer.TYPED_ARRAY_SUPPORT){that=new Uint8Array(length);that.__proto__=Buffer.prototype}else{that.length=length}var fromPool=length!==0&&length<=Buffer.poolSize>>>1;if(fromPool)that.parent=rootParent;return that}function checked(length){if(length>=kMaxLength()){throw new RangeError("Attempt to allocate Buffer larger than maximum "+"size: 0x"+kMaxLength().toString(16)+" bytes")}return length|0}function SlowBuffer(subject,encoding){if(!(this instanceof SlowBuffer))return new SlowBuffer(subject,encoding);var buf=new Buffer(subject,encoding);delete buf.parent;return buf}Buffer.isBuffer=function isBuffer(b){return!!(b!=null&&b._isBuffer)};Buffer.compare=function compare(a,b){if(!Buffer.isBuffer(a)||!Buffer.isBuffer(b)){throw new TypeError("Arguments must be Buffers")}if(a===b)return 0;var x=a.length;var y=b.length;for(var i=0,len=Math.min(x,y);i<len;++i){if(a[i]!==b[i]){x=a[i];y=b[i];break}}if(x<y)return-1;if(y<x)return 1;return 0};Buffer.isEncoding=function isEncoding(encoding){switch(String(encoding).toLowerCase()){case"hex":case"utf8":case"utf-8":case"ascii":case"binary":case"base64":case"raw":case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return true;default:return false}};Buffer.concat=function concat(list,length){if(!isArray(list))throw new TypeError("list argument must be an Array of Buffers.");if(list.length===0){return new Buffer(0)}var i;if(length===undefined){length=0;for(i=0;i<list.length;i++){length+=list[i].length}}var buf=new Buffer(length);var pos=0;for(i=0;i<list.length;i++){var item=list[i];item.copy(buf,pos);pos+=item.length}return buf};function byteLength(string,encoding){if(typeof string!=="string")string=""+string;var len=string.length;if(len===0)return 0;var loweredCase=false;for(;;){switch(encoding){case"ascii":case"binary":case"raw":case"raws":return len;case"utf8":case"utf-8":return utf8ToBytes(string).length;case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return len*2;case"hex":return len>>>1;case"base64":return base64ToBytes(string).length;default:if(loweredCase)return utf8ToBytes(string).length;encoding=(""+encoding).toLowerCase();loweredCase=true}}}Buffer.byteLength=byteLength;function slowToString(encoding,start,end){var loweredCase=false;start=start|0;end=end===undefined||end===Infinity?this.length:end|0;if(!encoding)encoding="utf8";if(start<0)start=0;if(end>this.length)end=this.length;if(end<=start)return"";while(true){switch(encoding){case"hex":return hexSlice(this,start,end);case"utf8":case"utf-8":return utf8Slice(this,start,end);case"ascii":return asciiSlice(this,start,end);case"binary":return binarySlice(this,start,end);case"base64":return base64Slice(this,start,end);case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return utf16leSlice(this,start,end);default:if(loweredCase)throw new TypeError("Unknown encoding: "+encoding);encoding=(encoding+"").toLowerCase();loweredCase=true}}}Buffer.prototype._isBuffer=true;Buffer.prototype.toString=function toString(){var length=this.length|0;if(length===0)return"";if(arguments.length===0)return utf8Slice(this,0,length);return slowToString.apply(this,arguments)};Buffer.prototype.equals=function equals(b){if(!Buffer.isBuffer(b))throw new TypeError("Argument must be a Buffer");if(this===b)return true;return Buffer.compare(this,b)===0};Buffer.prototype.inspect=function inspect(){var str="";var max=exports.INSPECT_MAX_BYTES;if(this.length>0){str=this.toString("hex",0,max).match(/.{2}/g).join(" ");if(this.length>max)str+=" ... "}return"<Buffer "+str+">"};Buffer.prototype.compare=function compare(b){if(!Buffer.isBuffer(b))throw new TypeError("Argument must be a Buffer");return Buffer.compare(this,b)};Buffer.prototype.indexOf=function indexOf(val,byteOffset){if(byteOffset>2147483647)byteOffset=2147483647;else if(byteOffset<-2147483648)byteOffset=-2147483648;byteOffset>>=0;if(this.length===0)return-1;if(byteOffset>=this.length)return-1;if(byteOffset<0)byteOffset=Math.max(this.length+byteOffset,0);if(typeof val==="string"){if(val.length===0)return-1;return String.prototype.indexOf.call(this,val,byteOffset)}if(Buffer.isBuffer(val)){return arrayIndexOf(this,val,byteOffset)}if(typeof val==="number"){if(Buffer.TYPED_ARRAY_SUPPORT&&Uint8Array.prototype.indexOf==="function"){return Uint8Array.prototype.indexOf.call(this,val,byteOffset)}return arrayIndexOf(this,[val],byteOffset)}function arrayIndexOf(arr,val,byteOffset){var foundIndex=-1;for(var i=0;byteOffset+i<arr.length;i++){if(arr[byteOffset+i]===val[foundIndex===-1?0:i-foundIndex]){if(foundIndex===-1)foundIndex=i;if(i-foundIndex+1===val.length)return byteOffset+foundIndex}else{foundIndex=-1}}return-1}throw new TypeError("val must be string, number or Buffer")};function hexWrite(buf,string,offset,length){offset=Number(offset)||0;var remaining=buf.length-offset;if(!length){length=remaining}else{length=Number(length);if(length>remaining){length=remaining}}var strLen=string.length;if(strLen%2!==0)throw new Error("Invalid hex string");if(length>strLen/2){length=strLen/2}for(var i=0;i<length;i++){var parsed=parseInt(string.substr(i*2,2),16);if(isNaN(parsed))throw new Error("Invalid hex string");buf[offset+i]=parsed}return i}function utf8Write(buf,string,offset,length){return blitBuffer(utf8ToBytes(string,buf.length-offset),buf,offset,length)}function asciiWrite(buf,string,offset,length){return blitBuffer(asciiToBytes(string),buf,offset,length)}function binaryWrite(buf,string,offset,length){return asciiWrite(buf,string,offset,length)}function base64Write(buf,string,offset,length){return blitBuffer(base64ToBytes(string),buf,offset,length)}function ucs2Write(buf,string,offset,length){return blitBuffer(utf16leToBytes(string,buf.length-offset),buf,offset,length)}Buffer.prototype.write=function write(string,offset,length,encoding){if(offset===undefined){encoding="utf8";length=this.length;offset=0}else if(length===undefined&&typeof offset==="string"){encoding=offset;length=this.length;offset=0}else if(isFinite(offset)){offset=offset|0;if(isFinite(length)){length=length|0;if(encoding===undefined)encoding="utf8"}else{encoding=length;length=undefined}}else{var swap=encoding;encoding=offset;offset=length|0;length=swap}var remaining=this.length-offset;if(length===undefined||length>remaining)length=remaining;if(string.length>0&&(length<0||offset<0)||offset>this.length){throw new RangeError("attempt to write outside buffer bounds")}if(!encoding)encoding="utf8";var loweredCase=false;for(;;){switch(encoding){case"hex":return hexWrite(this,string,offset,length);case"utf8":case"utf-8":return utf8Write(this,string,offset,length);case"ascii":return asciiWrite(this,string,offset,length);case"binary":return binaryWrite(this,string,offset,length);case"base64":return base64Write(this,string,offset,length);case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return ucs2Write(this,string,offset,length);default:if(loweredCase)throw new TypeError("Unknown encoding: "+encoding);encoding=(""+encoding).toLowerCase();loweredCase=true}}};Buffer.prototype.toJSON=function toJSON(){return{type:"Buffer",data:Array.prototype.slice.call(this._arr||this,0)}};function base64Slice(buf,start,end){if(start===0&&end===buf.length){return base64.fromByteArray(buf)}else{return base64.fromByteArray(buf.slice(start,end))}}function utf8Slice(buf,start,end){end=Math.min(buf.length,end);var res=[];var i=start;while(i<end){var firstByte=buf[i];var codePoint=null;var bytesPerSequence=firstByte>239?4:firstByte>223?3:firstByte>191?2:1;if(i+bytesPerSequence<=end){var secondByte,thirdByte,fourthByte,tempCodePoint;switch(bytesPerSequence){case 1:if(firstByte<128){codePoint=firstByte}break;case 2:secondByte=buf[i+1];if((secondByte&192)===128){tempCodePoint=(firstByte&31)<<6|secondByte&63;if(tempCodePoint>127){codePoint=tempCodePoint}}break;case 3:secondByte=buf[i+1];thirdByte=buf[i+2];if((secondByte&192)===128&&(thirdByte&192)===128){tempCodePoint=(firstByte&15)<<12|(secondByte&63)<<6|thirdByte&63;if(tempCodePoint>2047&&(tempCodePoint<55296||tempCodePoint>57343)){codePoint=tempCodePoint}}break;case 4:secondByte=buf[i+1];thirdByte=buf[i+2];fourthByte=buf[i+3];if((secondByte&192)===128&&(thirdByte&192)===128&&(fourthByte&192)===128){tempCodePoint=(firstByte&15)<<18|(secondByte&63)<<12|(thirdByte&63)<<6|fourthByte&63;if(tempCodePoint>65535&&tempCodePoint<1114112){codePoint=tempCodePoint}}}}if(codePoint===null){codePoint=65533;bytesPerSequence=1}else if(codePoint>65535){codePoint-=65536;res.push(codePoint>>>10&1023|55296);codePoint=56320|codePoint&1023}res.push(codePoint);i+=bytesPerSequence}return decodeCodePointsArray(res)}var MAX_ARGUMENTS_LENGTH=4096;function decodeCodePointsArray(codePoints){var len=codePoints.length;if(len<=MAX_ARGUMENTS_LENGTH){return String.fromCharCode.apply(String,codePoints)}var res="";var i=0;while(i<len){res+=String.fromCharCode.apply(String,codePoints.slice(i,i+=MAX_ARGUMENTS_LENGTH))}return res}function asciiSlice(buf,start,end){var ret="";end=Math.min(buf.length,end);for(var i=start;i<end;i++){ret+=String.fromCharCode(buf[i]&127)}return ret}function binarySlice(buf,start,end){var ret="";end=Math.min(buf.length,end);for(var i=start;i<end;i++){ret+=String.fromCharCode(buf[i])}return ret}function hexSlice(buf,start,end){var len=buf.length;if(!start||start<0)start=0;if(!end||end<0||end>len)end=len;var out="";for(var i=start;i<end;i++){out+=toHex(buf[i])}return out}function utf16leSlice(buf,start,end){var bytes=buf.slice(start,end);var res="";for(var i=0;i<bytes.length;i+=2){res+=String.fromCharCode(bytes[i]+bytes[i+1]*256)}return res}Buffer.prototype.slice=function slice(start,end){var len=this.length;start=~~start;end=end===undefined?len:~~end;if(start<0){start+=len;if(start<0)start=0}else if(start>len){start=len}if(end<0){end+=len;if(end<0)end=0}else if(end>len){end=len}if(end<start)end=start;var newBuf;if(Buffer.TYPED_ARRAY_SUPPORT){newBuf=this.subarray(start,end);newBuf.__proto__=Buffer.prototype}else{var sliceLen=end-start;newBuf=new Buffer(sliceLen,undefined);for(var i=0;i<sliceLen;i++){newBuf[i]=this[i+start]}}if(newBuf.length)newBuf.parent=this.parent||this;return newBuf};function checkOffset(offset,ext,length){if(offset%1!==0||offset<0)throw new RangeError("offset is not uint");if(offset+ext>length)throw new RangeError("Trying to access beyond buffer length")}Buffer.prototype.readUIntLE=function readUIntLE(offset,byteLength,noAssert){offset=offset|0;byteLength=byteLength|0;if(!noAssert)checkOffset(offset,byteLength,this.length);var val=this[offset];var mul=1;var i=0;while(++i<byteLength&&(mul*=256)){val+=this[offset+i]*mul}return val};Buffer.prototype.readUIntBE=function readUIntBE(offset,byteLength,noAssert){offset=offset|0;byteLength=byteLength|0;if(!noAssert){checkOffset(offset,byteLength,this.length)}var val=this[offset+--byteLength];var mul=1;while(byteLength>0&&(mul*=256)){val+=this[offset+--byteLength]*mul}return val};Buffer.prototype.readUInt8=function readUInt8(offset,noAssert){if(!noAssert)checkOffset(offset,1,this.length);return this[offset]};Buffer.prototype.readUInt16LE=function readUInt16LE(offset,noAssert){if(!noAssert)checkOffset(offset,2,this.length);return this[offset]|this[offset+1]<<8};Buffer.prototype.readUInt16BE=function readUInt16BE(offset,noAssert){if(!noAssert)checkOffset(offset,2,this.length);return this[offset]<<8|this[offset+1]};Buffer.prototype.readUInt32LE=function readUInt32LE(offset,noAssert){if(!noAssert)checkOffset(offset,4,this.length);return(this[offset]|this[offset+1]<<8|this[offset+2]<<16)+this[offset+3]*16777216};Buffer.prototype.readUInt32BE=function readUInt32BE(offset,noAssert){if(!noAssert)checkOffset(offset,4,this.length);return this[offset]*16777216+(this[offset+1]<<16|this[offset+2]<<8|this[offset+3])};Buffer.prototype.readIntLE=function readIntLE(offset,byteLength,noAssert){offset=offset|0;byteLength=byteLength|0;if(!noAssert)checkOffset(offset,byteLength,this.length);var val=this[offset];var mul=1;var i=0;while(++i<byteLength&&(mul*=256)){val+=this[offset+i]*mul}mul*=128;if(val>=mul)val-=Math.pow(2,8*byteLength);return val};Buffer.prototype.readIntBE=function readIntBE(offset,byteLength,noAssert){offset=offset|0;byteLength=byteLength|0;if(!noAssert)checkOffset(offset,byteLength,this.length);var i=byteLength;var mul=1;var val=this[offset+--i];while(i>0&&(mul*=256)){val+=this[offset+--i]*mul}mul*=128;if(val>=mul)val-=Math.pow(2,8*byteLength);return val};Buffer.prototype.readInt8=function readInt8(offset,noAssert){if(!noAssert)checkOffset(offset,1,this.length);if(!(this[offset]&128))return this[offset];return(255-this[offset]+1)*-1};Buffer.prototype.readInt16LE=function readInt16LE(offset,noAssert){if(!noAssert)checkOffset(offset,2,this.length);var val=this[offset]|this[offset+1]<<8;return val&32768?val|4294901760:val};Buffer.prototype.readInt16BE=function readInt16BE(offset,noAssert){if(!noAssert)checkOffset(offset,2,this.length);var val=this[offset+1]|this[offset]<<8;return val&32768?val|4294901760:val};Buffer.prototype.readInt32LE=function readInt32LE(offset,noAssert){if(!noAssert)checkOffset(offset,4,this.length);return this[offset]|this[offset+1]<<8|this[offset+2]<<16|this[offset+3]<<24};Buffer.prototype.readInt32BE=function readInt32BE(offset,noAssert){if(!noAssert)checkOffset(offset,4,this.length);return this[offset]<<24|this[offset+1]<<16|this[offset+2]<<8|this[offset+3]};Buffer.prototype.readFloatLE=function readFloatLE(offset,noAssert){if(!noAssert)checkOffset(offset,4,this.length);return ieee754.read(this,offset,true,23,4)};Buffer.prototype.readFloatBE=function readFloatBE(offset,noAssert){if(!noAssert)checkOffset(offset,4,this.length);return ieee754.read(this,offset,false,23,4)};Buffer.prototype.readDoubleLE=function readDoubleLE(offset,noAssert){if(!noAssert)checkOffset(offset,8,this.length);return ieee754.read(this,offset,true,52,8)};Buffer.prototype.readDoubleBE=function readDoubleBE(offset,noAssert){if(!noAssert)checkOffset(offset,8,this.length);return ieee754.read(this,offset,false,52,8)};function checkInt(buf,value,offset,ext,max,min){if(!Buffer.isBuffer(buf))throw new TypeError("buffer must be a Buffer instance");if(value>max||value<min)throw new RangeError("value is out of bounds");if(offset+ext>buf.length)throw new RangeError("index out of range")}Buffer.prototype.writeUIntLE=function writeUIntLE(value,offset,byteLength,noAssert){value=+value;offset=offset|0;byteLength=byteLength|0;if(!noAssert)checkInt(this,value,offset,byteLength,Math.pow(2,8*byteLength),0);var mul=1;var i=0;this[offset]=value&255;while(++i<byteLength&&(mul*=256)){this[offset+i]=value/mul&255}return offset+byteLength};Buffer.prototype.writeUIntBE=function writeUIntBE(value,offset,byteLength,noAssert){value=+value;offset=offset|0;byteLength=byteLength|0;if(!noAssert)checkInt(this,value,offset,byteLength,Math.pow(2,8*byteLength),0);var i=byteLength-1;var mul=1;this[offset+i]=value&255;while(--i>=0&&(mul*=256)){this[offset+i]=value/mul&255}return offset+byteLength};Buffer.prototype.writeUInt8=function writeUInt8(value,offset,noAssert){value=+value;offset=offset|0;if(!noAssert)checkInt(this,value,offset,1,255,0);if(!Buffer.TYPED_ARRAY_SUPPORT)value=Math.floor(value);this[offset]=value&255;return offset+1};function objectWriteUInt16(buf,value,offset,littleEndian){if(value<0)value=65535+value+1;for(var i=0,j=Math.min(buf.length-offset,2);i<j;i++){buf[offset+i]=(value&255<<8*(littleEndian?i:1-i))>>>(littleEndian?i:1-i)*8}}Buffer.prototype.writeUInt16LE=function writeUInt16LE(value,offset,noAssert){value=+value;offset=offset|0;if(!noAssert)checkInt(this,value,offset,2,65535,0);if(Buffer.TYPED_ARRAY_SUPPORT){this[offset]=value&255;this[offset+1]=value>>>8}else{objectWriteUInt16(this,value,offset,true)}return offset+2};Buffer.prototype.writeUInt16BE=function writeUInt16BE(value,offset,noAssert){value=+value;offset=offset|0;if(!noAssert)checkInt(this,value,offset,2,65535,0);if(Buffer.TYPED_ARRAY_SUPPORT){this[offset]=value>>>8;this[offset+1]=value&255}else{objectWriteUInt16(this,value,offset,false)}return offset+2};function objectWriteUInt32(buf,value,offset,littleEndian){if(value<0)value=4294967295+value+1;for(var i=0,j=Math.min(buf.length-offset,4);i<j;i++){buf[offset+i]=value>>>(littleEndian?i:3-i)*8&255}}Buffer.prototype.writeUInt32LE=function writeUInt32LE(value,offset,noAssert){value=+value;offset=offset|0;if(!noAssert)checkInt(this,value,offset,4,4294967295,0);if(Buffer.TYPED_ARRAY_SUPPORT){this[offset+3]=value>>>24;this[offset+2]=value>>>16;this[offset+1]=value>>>8;this[offset]=value&255}else{objectWriteUInt32(this,value,offset,true)}return offset+4};Buffer.prototype.writeUInt32BE=function writeUInt32BE(value,offset,noAssert){value=+value;offset=offset|0;if(!noAssert)checkInt(this,value,offset,4,4294967295,0);if(Buffer.TYPED_ARRAY_SUPPORT){this[offset]=value>>>24;this[offset+1]=value>>>16;this[offset+2]=value>>>8;this[offset+3]=value&255}else{objectWriteUInt32(this,value,offset,false)}return offset+4};Buffer.prototype.writeIntLE=function writeIntLE(value,offset,byteLength,noAssert){value=+value;offset=offset|0;if(!noAssert){var limit=Math.pow(2,8*byteLength-1);checkInt(this,value,offset,byteLength,limit-1,-limit)}var i=0;var mul=1;var sub=value<0?1:0;this[offset]=value&255;while(++i<byteLength&&(mul*=256)){this[offset+i]=(value/mul>>0)-sub&255}return offset+byteLength};Buffer.prototype.writeIntBE=function writeIntBE(value,offset,byteLength,noAssert){value=+value;offset=offset|0;if(!noAssert){var limit=Math.pow(2,8*byteLength-1);checkInt(this,value,offset,byteLength,limit-1,-limit)}var i=byteLength-1;var mul=1;var sub=value<0?1:0;this[offset+i]=value&255;while(--i>=0&&(mul*=256)){this[offset+i]=(value/mul>>0)-sub&255}return offset+byteLength};Buffer.prototype.writeInt8=function writeInt8(value,offset,noAssert){value=+value;offset=offset|0;if(!noAssert)checkInt(this,value,offset,1,127,-128);if(!Buffer.TYPED_ARRAY_SUPPORT)value=Math.floor(value);if(value<0)value=255+value+1;this[offset]=value&255;return offset+1};Buffer.prototype.writeInt16LE=function writeInt16LE(value,offset,noAssert){value=+value;offset=offset|0;if(!noAssert)checkInt(this,value,offset,2,32767,-32768);if(Buffer.TYPED_ARRAY_SUPPORT){this[offset]=value&255;this[offset+1]=value>>>8}else{objectWriteUInt16(this,value,offset,true)}return offset+2};Buffer.prototype.writeInt16BE=function writeInt16BE(value,offset,noAssert){value=+value;offset=offset|0;if(!noAssert)checkInt(this,value,offset,2,32767,-32768);if(Buffer.TYPED_ARRAY_SUPPORT){this[offset]=value>>>8;this[offset+1]=value&255}else{objectWriteUInt16(this,value,offset,false)}return offset+2};Buffer.prototype.writeInt32LE=function writeInt32LE(value,offset,noAssert){value=+value;offset=offset|0;if(!noAssert)checkInt(this,value,offset,4,2147483647,-2147483648);if(Buffer.TYPED_ARRAY_SUPPORT){this[offset]=value&255;this[offset+1]=value>>>8;this[offset+2]=value>>>16;this[offset+3]=value>>>24}else{objectWriteUInt32(this,value,offset,true)}return offset+4};Buffer.prototype.writeInt32BE=function writeInt32BE(value,offset,noAssert){value=+value;offset=offset|0;if(!noAssert)checkInt(this,value,offset,4,2147483647,-2147483648);if(value<0)value=4294967295+value+1;if(Buffer.TYPED_ARRAY_SUPPORT){this[offset]=value>>>24;this[offset+1]=value>>>16;this[offset+2]=value>>>8;this[offset+3]=value&255}else{objectWriteUInt32(this,value,offset,false)}return offset+4};function checkIEEE754(buf,value,offset,ext,max,min){if(offset+ext>buf.length)throw new RangeError("index out of range");if(offset<0)throw new RangeError("index out of range")}function writeFloat(buf,value,offset,littleEndian,noAssert){if(!noAssert){checkIEEE754(buf,value,offset,4,3.4028234663852886e38,-3.4028234663852886e38)}ieee754.write(buf,value,offset,littleEndian,23,4);return offset+4}Buffer.prototype.writeFloatLE=function writeFloatLE(value,offset,noAssert){return writeFloat(this,value,offset,true,noAssert)};Buffer.prototype.writeFloatBE=function writeFloatBE(value,offset,noAssert){
return writeFloat(this,value,offset,false,noAssert)};function writeDouble(buf,value,offset,littleEndian,noAssert){if(!noAssert){checkIEEE754(buf,value,offset,8,1.7976931348623157e308,-1.7976931348623157e308)}ieee754.write(buf,value,offset,littleEndian,52,8);return offset+8}Buffer.prototype.writeDoubleLE=function writeDoubleLE(value,offset,noAssert){return writeDouble(this,value,offset,true,noAssert)};Buffer.prototype.writeDoubleBE=function writeDoubleBE(value,offset,noAssert){return writeDouble(this,value,offset,false,noAssert)};Buffer.prototype.copy=function copy(target,targetStart,start,end){if(!start)start=0;if(!end&&end!==0)end=this.length;if(targetStart>=target.length)targetStart=target.length;if(!targetStart)targetStart=0;if(end>0&&end<start)end=start;if(end===start)return 0;if(target.length===0||this.length===0)return 0;if(targetStart<0){throw new RangeError("targetStart out of bounds")}if(start<0||start>=this.length)throw new RangeError("sourceStart out of bounds");if(end<0)throw new RangeError("sourceEnd out of bounds");if(end>this.length)end=this.length;if(target.length-targetStart<end-start){end=target.length-targetStart+start}var len=end-start;var i;if(this===target&&start<targetStart&&targetStart<end){for(i=len-1;i>=0;i--){target[i+targetStart]=this[i+start]}}else if(len<1e3||!Buffer.TYPED_ARRAY_SUPPORT){for(i=0;i<len;i++){target[i+targetStart]=this[i+start]}}else{Uint8Array.prototype.set.call(target,this.subarray(start,start+len),targetStart)}return len};Buffer.prototype.fill=function fill(value,start,end){if(!value)value=0;if(!start)start=0;if(!end)end=this.length;if(end<start)throw new RangeError("end < start");if(end===start)return;if(this.length===0)return;if(start<0||start>=this.length)throw new RangeError("start out of bounds");if(end<0||end>this.length)throw new RangeError("end out of bounds");var i;if(typeof value==="number"){for(i=start;i<end;i++){this[i]=value}}else{var bytes=utf8ToBytes(value.toString());var len=bytes.length;for(i=start;i<end;i++){this[i]=bytes[i%len]}}return this};var INVALID_BASE64_RE=/[^+\/0-9A-Za-z-_]/g;function base64clean(str){str=stringtrim(str).replace(INVALID_BASE64_RE,"");if(str.length<2)return"";while(str.length%4!==0){str=str+"="}return str}function stringtrim(str){if(str.trim)return str.trim();return str.replace(/^\s+|\s+$/g,"")}function toHex(n){if(n<16)return"0"+n.toString(16);return n.toString(16)}function utf8ToBytes(string,units){units=units||Infinity;var codePoint;var length=string.length;var leadSurrogate=null;var bytes=[];for(var i=0;i<length;i++){codePoint=string.charCodeAt(i);if(codePoint>55295&&codePoint<57344){if(!leadSurrogate){if(codePoint>56319){if((units-=3)>-1)bytes.push(239,191,189);continue}else if(i+1===length){if((units-=3)>-1)bytes.push(239,191,189);continue}leadSurrogate=codePoint;continue}if(codePoint<56320){if((units-=3)>-1)bytes.push(239,191,189);leadSurrogate=codePoint;continue}codePoint=(leadSurrogate-55296<<10|codePoint-56320)+65536}else if(leadSurrogate){if((units-=3)>-1)bytes.push(239,191,189)}leadSurrogate=null;if(codePoint<128){if((units-=1)<0)break;bytes.push(codePoint)}else if(codePoint<2048){if((units-=2)<0)break;bytes.push(codePoint>>6|192,codePoint&63|128)}else if(codePoint<65536){if((units-=3)<0)break;bytes.push(codePoint>>12|224,codePoint>>6&63|128,codePoint&63|128)}else if(codePoint<1114112){if((units-=4)<0)break;bytes.push(codePoint>>18|240,codePoint>>12&63|128,codePoint>>6&63|128,codePoint&63|128)}else{throw new Error("Invalid code point")}}return bytes}function asciiToBytes(str){var byteArray=[];for(var i=0;i<str.length;i++){byteArray.push(str.charCodeAt(i)&255)}return byteArray}function utf16leToBytes(str,units){var c,hi,lo;var byteArray=[];for(var i=0;i<str.length;i++){if((units-=2)<0)break;c=str.charCodeAt(i);hi=c>>8;lo=c%256;byteArray.push(lo);byteArray.push(hi)}return byteArray}function base64ToBytes(str){return base64.toByteArray(base64clean(str))}function blitBuffer(src,dst,offset,length){for(var i=0;i<length;i++){if(i+offset>=dst.length||i>=src.length)break;dst[i+offset]=src[i]}return i}}).call(this,typeof global!=="undefined"?global:typeof self!=="undefined"?self:typeof window!=="undefined"?window:{})},{"base64-js":3,ieee754:4,isarray:5}],3:[function(require,module,exports){"use strict";exports.toByteArray=toByteArray;exports.fromByteArray=fromByteArray;var lookup=[];var revLookup=[];var Arr=typeof Uint8Array!=="undefined"?Uint8Array:Array;function init(){var code="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/";for(var i=0,len=code.length;i<len;++i){lookup[i]=code[i];revLookup[code.charCodeAt(i)]=i}revLookup["-".charCodeAt(0)]=62;revLookup["_".charCodeAt(0)]=63}init();function toByteArray(b64){var i,j,l,tmp,placeHolders,arr;var len=b64.length;if(len%4>0){throw new Error("Invalid string. Length must be a multiple of 4")}placeHolders=b64[len-2]==="="?2:b64[len-1]==="="?1:0;arr=new Arr(len*3/4-placeHolders);l=placeHolders>0?len-4:len;var L=0;for(i=0,j=0;i<l;i+=4,j+=3){tmp=revLookup[b64.charCodeAt(i)]<<18|revLookup[b64.charCodeAt(i+1)]<<12|revLookup[b64.charCodeAt(i+2)]<<6|revLookup[b64.charCodeAt(i+3)];arr[L++]=tmp>>16&255;arr[L++]=tmp>>8&255;arr[L++]=tmp&255}if(placeHolders===2){tmp=revLookup[b64.charCodeAt(i)]<<2|revLookup[b64.charCodeAt(i+1)]>>4;arr[L++]=tmp&255}else if(placeHolders===1){tmp=revLookup[b64.charCodeAt(i)]<<10|revLookup[b64.charCodeAt(i+1)]<<4|revLookup[b64.charCodeAt(i+2)]>>2;arr[L++]=tmp>>8&255;arr[L++]=tmp&255}return arr}function tripletToBase64(num){return lookup[num>>18&63]+lookup[num>>12&63]+lookup[num>>6&63]+lookup[num&63]}function encodeChunk(uint8,start,end){var tmp;var output=[];for(var i=start;i<end;i+=3){tmp=(uint8[i]<<16)+(uint8[i+1]<<8)+uint8[i+2];output.push(tripletToBase64(tmp))}return output.join("")}function fromByteArray(uint8){var tmp;var len=uint8.length;var extraBytes=len%3;var output="";var parts=[];var maxChunkLength=16383;for(var i=0,len2=len-extraBytes;i<len2;i+=maxChunkLength){parts.push(encodeChunk(uint8,i,i+maxChunkLength>len2?len2:i+maxChunkLength))}if(extraBytes===1){tmp=uint8[len-1];output+=lookup[tmp>>2];output+=lookup[tmp<<4&63];output+="=="}else if(extraBytes===2){tmp=(uint8[len-2]<<8)+uint8[len-1];output+=lookup[tmp>>10];output+=lookup[tmp>>4&63];output+=lookup[tmp<<2&63];output+="="}parts.push(output);return parts.join("")}},{}],4:[function(require,module,exports){exports.read=function(buffer,offset,isLE,mLen,nBytes){var e,m;var eLen=nBytes*8-mLen-1;var eMax=(1<<eLen)-1;var eBias=eMax>>1;var nBits=-7;var i=isLE?nBytes-1:0;var d=isLE?-1:1;var s=buffer[offset+i];i+=d;e=s&(1<<-nBits)-1;s>>=-nBits;nBits+=eLen;for(;nBits>0;e=e*256+buffer[offset+i],i+=d,nBits-=8){}m=e&(1<<-nBits)-1;e>>=-nBits;nBits+=mLen;for(;nBits>0;m=m*256+buffer[offset+i],i+=d,nBits-=8){}if(e===0){e=1-eBias}else if(e===eMax){return m?NaN:(s?-1:1)*Infinity}else{m=m+Math.pow(2,mLen);e=e-eBias}return(s?-1:1)*m*Math.pow(2,e-mLen)};exports.write=function(buffer,value,offset,isLE,mLen,nBytes){var e,m,c;var eLen=nBytes*8-mLen-1;var eMax=(1<<eLen)-1;var eBias=eMax>>1;var rt=mLen===23?Math.pow(2,-24)-Math.pow(2,-77):0;var i=isLE?0:nBytes-1;var d=isLE?1:-1;var s=value<0||value===0&&1/value<0?1:0;value=Math.abs(value);if(isNaN(value)||value===Infinity){m=isNaN(value)?1:0;e=eMax}else{e=Math.floor(Math.log(value)/Math.LN2);if(value*(c=Math.pow(2,-e))<1){e--;c*=2}if(e+eBias>=1){value+=rt/c}else{value+=rt*Math.pow(2,1-eBias)}if(value*c>=2){e++;c/=2}if(e+eBias>=eMax){m=0;e=eMax}else if(e+eBias>=1){m=(value*c-1)*Math.pow(2,mLen);e=e+eBias}else{m=value*Math.pow(2,eBias-1)*Math.pow(2,mLen);e=0}}for(;mLen>=8;buffer[offset+i]=m&255,i+=d,m/=256,mLen-=8){}e=e<<mLen|m;eLen+=mLen;for(;eLen>0;buffer[offset+i]=e&255,i+=d,e/=256,eLen-=8){}buffer[offset+i-d]|=s*128}},{}],5:[function(require,module,exports){var toString={}.toString;module.exports=Array.isArray||function(arr){return toString.call(arr)=="[object Array]"}},{}],6:[function(require,module,exports){module.exports=Emitter;function Emitter(obj){if(obj)return mixin(obj)}function mixin(obj){for(var key in Emitter.prototype){obj[key]=Emitter.prototype[key]}return obj}Emitter.prototype.on=Emitter.prototype.addEventListener=function(event,fn){this._callbacks=this._callbacks||{};(this._callbacks["$"+event]=this._callbacks["$"+event]||[]).push(fn);return this};Emitter.prototype.once=function(event,fn){function on(){this.off(event,on);fn.apply(this,arguments)}on.fn=fn;this.on(event,on);return this};Emitter.prototype.off=Emitter.prototype.removeListener=Emitter.prototype.removeAllListeners=Emitter.prototype.removeEventListener=function(event,fn){this._callbacks=this._callbacks||{};if(0==arguments.length){this._callbacks={};return this}var callbacks=this._callbacks["$"+event];if(!callbacks)return this;if(1==arguments.length){delete this._callbacks["$"+event];return this}var cb;for(var i=0;i<callbacks.length;i++){cb=callbacks[i];if(cb===fn||cb.fn===fn){callbacks.splice(i,1);break}}return this};Emitter.prototype.emit=function(event){this._callbacks=this._callbacks||{};var args=[].slice.call(arguments,1),callbacks=this._callbacks["$"+event];if(callbacks){callbacks=callbacks.slice(0);for(var i=0,len=callbacks.length;i<len;++i){callbacks[i].apply(this,args)}}return this};Emitter.prototype.listeners=function(event){this._callbacks=this._callbacks||{};return this._callbacks["$"+event]||[]};Emitter.prototype.hasListeners=function(event){return!!this.listeners(event).length}},{}],7:[function(require,module,exports){var Encoder=module.exports;Encoder.encodeUInt32=function(num){var n=parseInt(num);if(isNaN(n)||n<0){console.log(n);return null}var result=[];do{var tmp=n%128;var next=Math.floor(n/128);if(next!==0){tmp=tmp+128}result.push(tmp);n=next}while(n!==0);return result};Encoder.encodeSInt32=function(num){var n=parseInt(num);if(isNaN(n)){return null}n=n<0?Math.abs(n)*2-1:n*2;return Encoder.encodeUInt32(n)};Encoder.decodeUInt32=function(bytes){var n=0;for(var i=0;i<bytes.length;i++){var m=parseInt(bytes[i]);n=n+(m&127)*Math.pow(2,7*i);if(m<128){return n}}return n};Encoder.decodeSInt32=function(bytes){var n=this.decodeUInt32(bytes);var flag=n%2===1?-1:1;n=(n%2+n)/2*flag;return n}},{}],8:[function(require,module,exports){module.exports={TYPES:{uInt32:0,sInt32:0,int32:0,"double":1,string:2,message:2,"float":5}}},{}],9:[function(require,module,exports){var codec=require("./codec");var util=require("./util");var Decoder=module.exports;var buffer;var offset=0;Decoder.init=function(protos){this.protos=protos||{}};Decoder.setProtos=function(protos){if(!!protos){this.protos=protos}};Decoder.decode=function(route,buf){var protos=this.protos[route];buffer=buf;offset=0;if(!!protos){return decodeMsg({},protos,buffer.length)}return null};function decodeMsg(msg,protos,length){while(offset<length){var head=getHead();var type=head.type;var tag=head.tag;var name=protos.__tags[tag];switch(protos[name].option){case"optional":case"required":msg[name]=decodeProp(protos[name].type,protos);break;case"repeated":if(!msg[name]){msg[name]=[]}decodeArray(msg[name],protos[name].type,protos);break}}return msg}function isFinish(msg,protos){return!protos.__tags[peekHead().tag]}function getHead(){var tag=codec.decodeUInt32(getBytes());return{type:tag&7,tag:tag>>3}}function peekHead(){var tag=codec.decodeUInt32(peekBytes());return{type:tag&7,tag:tag>>3}}function decodeProp(type,protos){switch(type){case"uInt32":return codec.decodeUInt32(getBytes());case"int32":case"sInt32":return codec.decodeSInt32(getBytes());case"float":var float=buffer.readFloatLE(offset);offset+=4;return float;case"double":var double=buffer.readDoubleLE(offset);offset+=8;return double;case"string":var length=codec.decodeUInt32(getBytes());var str=buffer.toString("utf8",offset,offset+length);offset+=length;return str;default:var message=protos&&(protos.__messages[type]||Decoder.protos["message "+type]);if(message){var length=codec.decodeUInt32(getBytes());var msg={};decodeMsg(msg,message,offset+length);return msg}break}}function decodeArray(array,type,protos){if(util.isSimpleType(type)){var length=codec.decodeUInt32(getBytes());for(var i=0;i<length;i++){array.push(decodeProp(type))}}else{array.push(decodeProp(type,protos))}}function getBytes(flag){var bytes=[];var pos=offset;flag=flag||false;var b;do{var b=buffer.readUInt8(pos);bytes.push(b);pos++}while(b>=128);if(!flag){offset=pos}return bytes}function peekBytes(){return getBytes(true)}},{"./codec":7,"./util":13}],10:[function(require,module,exports){(function(Buffer){var codec=require("./codec");var constant=require("./constant");var util=require("./util");var Encoder=module.exports;Encoder.init=function(protos){this.protos=protos||{}};Encoder.encode=function(route,msg){if(!route||!msg){console.warn("Route or msg can not be null! route : %j, msg %j",route,msg);return null}var protos=this.protos[route];if(!checkMsg(msg,protos)){console.warn("check msg failed! msg : %j, proto : %j",msg,protos);return null}var length=Buffer.byteLength(JSON.stringify(msg))*2;var buffer=new Buffer(length);var offset=0;if(!!protos){offset=encodeMsg(buffer,offset,protos,msg);if(offset>0){return buffer.slice(0,offset)}}return null};function checkMsg(msg,protos){if(!protos||!msg){console.warn("no protos or msg exist! msg : %j, protos : %j",msg,protos);return false}for(var name in protos){var proto=protos[name];switch(proto.option){case"required":if(typeof msg[name]==="undefined"){console.warn("no property exist for required! name: %j, proto: %j, msg: %j",name,proto,msg);return false}case"optional":if(typeof msg[name]!=="undefined"){var message=protos.__messages[proto.type]||Encoder.protos["message "+proto.type];if(!!message&&!checkMsg(msg[name],message)){console.warn("inner proto error! name: %j, proto: %j, msg: %j",name,proto,msg);return false}}break;case"repeated":var message=protos.__messages[proto.type]||Encoder.protos["message "+proto.type];if(!!msg[name]&&!!message){for(var i=0;i<msg[name].length;i++){if(!checkMsg(msg[name][i],message)){return false}}}break}}return true}function encodeMsg(buffer,offset,protos,msg){for(var name in msg){if(!!protos[name]){var proto=protos[name];switch(proto.option){case"required":case"optional":offset=writeBytes(buffer,offset,encodeTag(proto.type,proto.tag));offset=encodeProp(msg[name],proto.type,offset,buffer,protos);break;case"repeated":if(!!msg[name]&&msg[name].length>0){offset=encodeArray(msg[name],proto,offset,buffer,protos)}break}}}return offset}function encodeProp(value,type,offset,buffer,protos){var length=0;switch(type){case"uInt32":offset=writeBytes(buffer,offset,codec.encodeUInt32(value));break;case"int32":case"sInt32":offset=writeBytes(buffer,offset,codec.encodeSInt32(value));break;case"float":buffer.writeFloatLE(value,offset);offset+=4;break;case"double":buffer.writeDoubleLE(value,offset);offset+=8;break;case"string":length=Buffer.byteLength(value);offset=writeBytes(buffer,offset,codec.encodeUInt32(length));buffer.write(value,offset,length);offset+=length;break;default:var message=protos.__messages[type]||Encoder.protos["message "+type];if(!!message){var tmpBuffer=new Buffer(Buffer.byteLength(JSON.stringify(value))*2);length=0;length=encodeMsg(tmpBuffer,length,message,value);offset=writeBytes(buffer,offset,codec.encodeUInt32(length));tmpBuffer.copy(buffer,offset,0,length);offset+=length}break}return offset}function encodeArray(array,proto,offset,buffer,protos){var i=0;if(util.isSimpleType(proto.type)){offset=writeBytes(buffer,offset,encodeTag(proto.type,proto.tag));offset=writeBytes(buffer,offset,codec.encodeUInt32(array.length));for(i=0;i<array.length;i++){offset=encodeProp(array[i],proto.type,offset,buffer)}}else{for(i=0;i<array.length;i++){offset=writeBytes(buffer,offset,encodeTag(proto.type,proto.tag));offset=encodeProp(array[i],proto.type,offset,buffer,protos)}}return offset}function writeBytes(buffer,offset,bytes){for(var i=0;i<bytes.length;i++){buffer.writeUInt8(bytes[i],offset);offset++}return offset}function encodeTag(type,tag){var value=constant.TYPES[type];if(value===undefined)value=2;return codec.encodeUInt32(tag<<3|value)}}).call(this,require("buffer").Buffer)},{"./codec":7,"./constant":8,"./util":13,buffer:2}],11:[function(require,module,exports){var Parser=module.exports;Parser.parse=function(protos){var maps={};for(var key in protos){maps[key]=parseObject(protos[key])}return maps};function parseObject(obj){var proto={};var nestProtos={};var tags={};for(var name in obj){var tag=obj[name];var params=name.split(" ");switch(params[0]){case"message":if(params.length!==2){continue}nestProtos[params[1]]=parseObject(tag);continue;case"required":case"optional":case"repeated":{if(params.length!==3||!!tags[tag]){continue}proto[params[2]]={option:params[0],type:params[1],tag:tag};tags[tag]=params[2]}}}proto.__messages=nestProtos;proto.__tags=tags;return proto}},{}],12:[function(require,module,exports){(function(Buffer){var encoder=require("./encoder");var decoder=require("./decoder");var parser=require("./parser");var Protobuf=module.exports;Protobuf.encode=function(key,msg){return encoder.encode(key,msg)};Protobuf.encode2Bytes=function(key,msg){var buffer=this.encode(key,msg);if(!buffer||!buffer.length){console.warn("encode msg failed! key : %j, msg : %j",key,msg);return null}var bytes=new Uint8Array(buffer.length);for(var offset=0;offset<buffer.length;offset++){bytes[offset]=buffer.readUInt8(offset)}return bytes};Protobuf.encodeStr=function(key,msg,code){code=code||"base64";var buffer=Protobuf.encode(key,msg);return!!buffer?buffer.toString(code):buffer};Protobuf.decode=function(key,msg){return decoder.decode(key,msg)};Protobuf.decodeStr=function(key,str,code){code=code||"base64";var buffer=new Buffer(str,code);return!!buffer?Protobuf.decode(key,buffer):buffer};Protobuf.parse=function(json){return parser.parse(json)};Protobuf.setEncoderProtos=function(protos){encoder.init(protos)};Protobuf.setDecoderProtos=function(protos){decoder.init(protos)};Protobuf.init=function(opts){encoder.init(opts.encoderProtos);decoder.init(opts.decoderProtos)}}).call(this,require("buffer").Buffer)},{"./decoder":9,"./encoder":10,"./parser":11,buffer:2}],13:[function(require,module,exports){var util=module.exports;util.isSimpleType=function(type){return type==="uInt32"||type==="sInt32"||type==="int32"||type==="uInt64"||type==="sInt64"||type==="float"||type==="double"};util.equal=function(obj0,obj1){for(var key in obj0){var m=obj0[key];var n=obj1[key];if(typeof m==="object"){if(!util.equal(m,n)){return false}}else if(m!==n){return false}}return true}},{}],14:[function(require,module,exports){module.exports=require("./lib/protocol")},{"./lib/protocol":15}],15:[function(require,module,exports){(function(Buffer){(function(exports,ByteArray,global){var Protocol=exports;var PKG_HEAD_BYTES=4;var MSG_FLAG_BYTES=1;var MSG_ROUTE_CODE_BYTES=2;var MSG_ID_MAX_BYTES=5;var MSG_ROUTE_LEN_BYTES=1;var MSG_ROUTE_CODE_MAX=65535;var MSG_COMPRESS_ROUTE_MASK=1;var MSG_COMPRESS_GZIP_MASK=1;var MSG_COMPRESS_GZIP_ENCODE_MASK=1<<4;var MSG_TYPE_MASK=7;var Package=Protocol.Package={};var Message=Protocol.Message={};Package.TYPE_HANDSHAKE=1;Package.TYPE_HANDSHAKE_ACK=2;Package.TYPE_HEARTBEAT=3;Package.TYPE_DATA=4;Package.TYPE_KICK=5;Message.TYPE_REQUEST=0;Message.TYPE_NOTIFY=1;Message.TYPE_RESPONSE=2;Message.TYPE_PUSH=3;Protocol.strencode=function(str){if(typeof Buffer!=="undefined"&&ByteArray===Buffer){return new Buffer(str)}else{var byteArray=new ByteArray(str.length*3);var offset=0;for(var i=0;i<str.length;i++){var charCode=str.charCodeAt(i);var codes=null;if(charCode<=127){codes=[charCode]}else if(charCode<=2047){codes=[192|charCode>>6,128|charCode&63]}else{codes=[224|charCode>>12,128|(charCode&4032)>>6,128|charCode&63]}for(var j=0;j<codes.length;j++){byteArray[offset]=codes[j];++offset}}var _buffer=new ByteArray(offset);copyArray(_buffer,0,byteArray,0,offset);return _buffer}};Protocol.strdecode=function(buffer){if(typeof Buffer!=="undefined"&&ByteArray===Buffer){return buffer.toString()}else{var bytes=new ByteArray(buffer);var array=[];var offset=0;var charCode=0;var end=bytes.length;while(offset<end){if(bytes[offset]<128){charCode=bytes[offset];offset+=1}else if(bytes[offset]<224){charCode=((bytes[offset]&31)<<6)+(bytes[offset+1]&63);offset+=2}else{charCode=((bytes[offset]&15)<<12)+((bytes[offset+1]&63)<<6)+(bytes[offset+2]&63);offset+=3}array.push(charCode)}return String.fromCharCode.apply(null,array)}};Package.encode=function(type,body){var length=body?body.length:0;var buffer=new ByteArray(PKG_HEAD_BYTES+length);var index=0;buffer[index++]=type&255;buffer[index++]=length>>16&255;buffer[index++]=length>>8&255;buffer[index++]=length&255;if(body){copyArray(buffer,index,body,0,length)}return buffer};Package.decode=function(buffer){var offset=0;var bytes=new ByteArray(buffer);var length=0;var rs=[];while(offset<bytes.length){var type=bytes[offset++];length=(bytes[offset++]<<16|bytes[offset++]<<8|bytes[offset++])>>>0;var body=length?new ByteArray(length):null;if(body){copyArray(body,0,bytes,offset,length)}offset+=length;rs.push({type:type,body:body})}return rs.length===1?rs[0]:rs};Message.encode=function(id,type,compressRoute,route,msg,compressGzip){var idBytes=msgHasId(type)?caculateMsgIdBytes(id):0;var msgLen=MSG_FLAG_BYTES+idBytes;if(msgHasRoute(type)){if(compressRoute){if(typeof route!=="number"){throw new Error("error flag for number route!")}msgLen+=MSG_ROUTE_CODE_BYTES}else{msgLen+=MSG_ROUTE_LEN_BYTES;if(route){route=Protocol.strencode(route);if(route.length>255){throw new Error("route maxlength is overflow")}msgLen+=route.length}}}if(msg){msgLen+=msg.length}var buffer=new ByteArray(msgLen);var offset=0;offset=encodeMsgFlag(type,compressRoute,buffer,offset,compressGzip);if(msgHasId(type)){offset=encodeMsgId(id,buffer,offset)}if(msgHasRoute(type)){offset=encodeMsgRoute(compressRoute,route,buffer,offset)}if(msg){offset=encodeMsgBody(msg,buffer,offset)}return buffer};Message.decode=function(buffer){var bytes=new ByteArray(buffer);var bytesLen=bytes.length||bytes.byteLength;var offset=0;var id=0;var route=null;var flag=bytes[offset++];var compressRoute=flag&MSG_COMPRESS_ROUTE_MASK;var type=flag>>1&MSG_TYPE_MASK;var compressGzip=flag>>4&MSG_COMPRESS_GZIP_MASK;if(msgHasId(type)){var m=0;var i=0;do{m=parseInt(bytes[offset]);id+=(m&127)<<7*i;offset++;i++}while(m>=128)}if(msgHasRoute(type)){if(compressRoute){route=bytes[offset++]<<8|bytes[offset++]}else{var routeLen=bytes[offset++];if(routeLen){route=new ByteArray(routeLen);copyArray(route,0,bytes,offset,routeLen);route=Protocol.strdecode(route)}else{route=""}offset+=routeLen}}var bodyLen=bytesLen-offset;var body=new ByteArray(bodyLen);copyArray(body,0,bytes,offset,bodyLen);return{id:id,type:type,compressRoute:compressRoute,route:route,body:body,compressGzip:compressGzip}};var copyArray=function(dest,doffset,src,soffset,length){if("function"===typeof src.copy){src.copy(dest,doffset,soffset,soffset+length)}else{for(var index=0;index<length;index++){dest[doffset++]=src[soffset++]}}};var msgHasId=function(type){return type===Message.TYPE_REQUEST||type===Message.TYPE_RESPONSE};var msgHasRoute=function(type){return type===Message.TYPE_REQUEST||type===Message.TYPE_NOTIFY||type===Message.TYPE_PUSH};var caculateMsgIdBytes=function(id){var len=0;do{len+=1;id>>=7}while(id>0);return len};var encodeMsgFlag=function(type,compressRoute,buffer,offset,compressGzip){if(type!==Message.TYPE_REQUEST&&type!==Message.TYPE_NOTIFY&&type!==Message.TYPE_RESPONSE&&type!==Message.TYPE_PUSH){throw new Error("unkonw message type: "+type)}buffer[offset]=type<<1|(compressRoute?1:0);if(compressGzip){buffer[offset]=buffer[offset]|MSG_COMPRESS_GZIP_ENCODE_MASK}return offset+MSG_FLAG_BYTES};var encodeMsgId=function(id,buffer,offset){do{var tmp=id%128;var next=Math.floor(id/128);if(next!==0){tmp=tmp+128}buffer[offset++]=tmp;id=next}while(id!==0);return offset};var encodeMsgRoute=function(compressRoute,route,buffer,offset){if(compressRoute){if(route>MSG_ROUTE_CODE_MAX){throw new Error("route number is overflow")}buffer[offset++]=route>>8&255;buffer[offset++]=route&255}else{if(route){buffer[offset++]=route.length&255;copyArray(buffer,offset,route,0,route.length);offset+=route.length}else{buffer[offset++]=0}}return offset};var encodeMsgBody=function(msg,buffer,offset){copyArray(buffer,offset,msg,0,msg.length);return offset+msg.length};module.exports=Protocol;if(typeof window!="undefined"){window.Protocol=Protocol}})(typeof window=="undefined"?module.exports:this.Protocol={},typeof window=="undefined"?Buffer:Uint8Array,this)}).call(this,require("buffer").Buffer)},{buffer:2}],16:[function(require,module,exports){var Emitter=require("component-emitter");window.EventEmitter=Emitter;var protocol=require("pomelo-protocol");window.Protocol=protocol;var protobuf=require("pomelo-protobuf");window.protobuf=protobuf;var pomelo=require("../lib/pomelo-client");window.pomelo=pomelo},{"../lib/pomelo-client":1,"component-emitter":6,"pomelo-protobuf":12,"pomelo-protocol":14}]},{},[16]);
